#!/usr/bin/env bash

function bootstrap {
  local shome="$(cd -P -- "$(dirname -- "$BASH_SOURCE")/.." && pwd -P)"

  git clone git@github.com:sstephenson/rbenv.git "$shome/.rbenv"
  git clone git@github.com:sstephenson/ruby-build.git "$shome/.ruby-build"
  source "$shome/script/profile"

  if [[ -z "${RBENV_VERSION:-}" ]]; then
    echo "WARN: RBENV_VERSION not defined, skip bootstrapping" 1>&2
    return 0
  fi

  case "$(uname -s)" in
    Linux)
      sudo aptitude update
      sudo aptitude install -y libffi-dev libssl-dev libreadline-dev build-essential # TODO belongs in a build block
      ;;
  esac

  export RUBY_CONFIGURE_OPTS=--disable-install-doc 
  rbenv install "$RBENV_VERSION"
  gem install bundler
}

bootstrap
