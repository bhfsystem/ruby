#!/usr/bin/env bash

function bootstrap {
  local shome="$(cd -P -- "$(dirname -- "$BASH_SOURCE")/.." && pwd -P)"

  git clone git@github.com:rbenv/rbenv.git "$shome/.rbenv"
  git clone git@github.com:rbenv/ruby-build.git "$shome/.ruby-build"
  source "$shome/script/profile"

  export RUBY_CONFIGURE_OPTS='--disable-install-doc --disable-dtrace' 
  #env DTRACE_DRTI_O='/usr/lib/dtrace/64/drti.o' 

  rbenv install
  gem install bundler
  gem install bundler -v 1.10.6

  local pth_ruby_install="$(rbenv which ruby 2>/dev/null | perl -pe 's{/bin/ruby}{}')"
  local id_ruby_install="$(echo "${ID_INSTALL%%__*}${pth_ruby_install}" | perl -pe 's{\s$}{}; s{\W+}{_}g')"
  tar cvfz "$id_ruby_install.tar.gz" "$pth_ruby_install"
}

bootstrap
